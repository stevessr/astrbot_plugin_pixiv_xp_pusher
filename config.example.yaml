# Pixiv XP Pusher 配置文件示例
# 请复制此文件为 config.yaml 并填入您的真实信息

pixiv:
  # Pixiv 刷新令牌 (通过 get_token.py 获取，或手动填入)
  # 此 Token 用于搜索、排行榜等操作
  refresh_token: "YOUR_REFRESH_TOKEN_HERE"

  # 可选：同步专用 Token (仅用于获取收藏和关注动态)
  # 使用独立 Token 可降低主号因搜索等操作被封禁的风险
  # 留空或删除此行则使用主 Token
  sync_token: ""

  # 您的 Pixiv 用户ID (自动获取，或手动指定)
  user_id: 0

# 启用的功能策略
strategies:
  - xp_search # 基于 XP 画像的每日搜索推荐
  - related # 连锁反应 (点赞后推送关联作品)
  - ranking # 每日排行榜推送
  - subscription # 关注画师的更新推送

profiler:
  # AI 标签分析配置
  ai:
    enabled: true
    # AI 提供商: openai / gemini / claude (目前主要支持 openai 格式)
    provider: "openai"
    # API 密钥
    api_key: "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    # API 基础地址 (如果使用中转服务)
    base_url: "https://api.openai.com/v1"
    # 模型名称
    model: "gpt-4o-mini"
    # 并发请求数 (建议 5-20)
    concurrency: 10
    # 批次大小
    batch_size: 200

    # 标签清洗配置
    filter_meaningless: true
    merge_synonyms: true

  # 标签画像配置
  scan_limit: 1000 # 扫描收藏数量上限
  discovery_rate: 0.1 # 探索新 Tag 的概率 (0.1 = 10%)
  time_decay_days: 180 # 时间衰减半衰期（天），权重随时间降低
  saturation_threshold: 0.5 # 高频 Tag 饱和度阈值 (0-1)，超过此比例自动过滤

  # 画像生成时保留权重最高的 N 个标签
  top_n: 20
  # 是否包含私密收藏用于分析
  include_private: true

  # 停用词 (手动指定)
  stop_words:
    - original
    - manga
    - pixiv
    - illustration

# AI 增强配置 (可选，默认关闭)
ai:
  # Embedding 语义匹配 - 借鉴 X 算法 Two-Tower Model
  # 使用向量相似度替代简单 Tag 交集匹配，提升推荐精准度
  embedding:
    enabled: false # 是否启用 (默认关闭)
    provider: openai # openai (第三方API) | local (本地模型)
    api_key: "" # OpenAI/DeepSeek 等 API Key
    base_url: "" # API 地址 (留空使用 OpenAI 官方)
    model: text-embedding-3-small # 模型名
    dimensions: 256 # 向量维度 (越低越省存储, 256/512/1024)
    semantic_weight: 0.3 # 语义分数权重 (0-1, 与 Tag 分数加权)
    cache_ttl_days: 30 # Embedding 缓存天数

  # AI 评分器 (LLM 精排，对候选作品进行二次评分)
  scorer:
    enabled: false # 是否启用
    provider: openai # openai 或其他兼容 API
    api_key: "" # 可复用 profiler.ai 的配置
    base_url: "" # 留空使用 OpenAI 官方
    model: gpt-4o-mini # 推荐轻量模型以降低成本
    max_candidates: 50 # 候选超过此数量时跳过 AI 评分
    score_weight: 0.3 # AI 分数权重 (用于与基础分数混合)

scheduler:
  # 定时任务配置 (Cron 表达式: 分 时 日 月 周)
  # 示例: 每天中午 12:00 执行
  cron: "0 12 * * *"
  # 是否合并错过的任务
  coalesce: true
  # 每日维护任务时间 (日报 + 清理)
  daily_report_cron: "0 0 * * *"

filter:
  match_score:
    min_threshold: 0.1 # 匹配度低于此分数的作品会被丢弃
    weight_in_sort: 0.6 # 排序时匹配度占的权重 (0.6表示匹配度占60%, 收藏数占40%)

  daily_limit:
    20 # 单次任务推送上限 (Per-Run Limit)
    # 注意：此参数控制每次脚本运行时最多推送多少张
    # 如果您每小时运行一次，全天总量 = 24 * daily_limit
  exclude_ai: false # 过滤 AI 生成作品
  max_per_artist: 3 # 单画师最多推送数
  artist_boost: 0.3 # 订阅画师加成
  min_create_days: 30 # 过滤 N 天前的作品
  r18_mode: "mixed" # 模式: mixed (混合), r18_only (纯R18), safe (仅全年龄). mixed=false, r18_only=true

  # 多样性增强 (让每次推送都不太一样)
  shuffle_factor: 0.15 # 随机打散因子 (0-0.5)，让排序结果每次不同
  exploration_ratio: 0.2 # 探索比例，从候选池随机抽取 20% 的"潜力股"

  # 黑名单标签
  blacklist_tags:
    - "R-18G"

  # === 推荐增强选项 (借鉴 X 算法) ===

  # 画师多样性衰减：同一画师后续作品分数递减，防止信息茧房
  # 借鉴 X 算法 AuthorDiversityScorer
  # 公式: multiplier(position) = (1.0 - floor) × decay^position + floor
  author_diversity:
    enabled: true # 是否启用
    decay_factor: 0.7 # 衰减因子 (0.1-1.0, 越小衰减越快)
    floor: 0.1 # 保底系数 (避免完全降为0)

  # 来源加成：不同策略来源的作品应用不同权重
  # 借鉴 X 算法 OON Scorer (Out-of-Network)
  source_boost:
    xp_search: 1.0 # XP 画像搜索 (基准)
    subscription: 1.1 # 订阅/关注 (轻微加成)
    ranking: 0.9 # 排行榜 (轻微降权)
    related: 1.15 # 关联作品 (发现加成)
    engagement_artists: 1.2 # 互动画师 (新策略, 高加成)

fetcher:
  bookmark_threshold:
    search: 1000 # 搜索结果的最低收藏数要求
    subscription: 0

  subscribed_artists: [] # 额外关注的画师 ID 列表

  date_range_days: 7 # 获取最近 N 天的作品

  # 动态阈值配置 (冷门标签搜索优化)
  dynamic_threshold:
    min: 100 # 保底收藏数 (无论多冷门的标签都至少要这么多收藏)
    rate: 0.05 # 相对热度比例 (取该标签最高收藏作品的 5%)

  search_limit: 50 # 每次搜索获取的作品数量 (默认 50)

  ranking:
    enabled: true
    modes: ["day", "week", "month"]
    limit: 100

  match_score:
    min_threshold: 0.4
    weight_in_sort: 0.5

  # MAB 策略配额限制 (占比 0.0 - 1.0)
  mab_limits:
    # 至少保留 20% 给每个策略，防止饿死
    min_quota: 0.2
    # 任何单一策略最多占用 60%
    max_quota: 0.6

notifier:
  # 启用的推送通道列表: telegram, onebot
  types: [telegram]

  # 多图作品配置
  max_pages: 10 # 打包发送的最大页数
  multi_page_mode: "cover_link" # 模式: cover_link / media_group

  # 邮件配置
  email:
    smtp_host: ""
    smtp_port: 465
    to_address: ""
    username: ""

  # Telegram Bot
  telegram:
    bot_token: "YOUR_BOT_TOKEN_HERE"
    # 推送目标 Chat ID (支持列表)
    chat_ids:
      - 123456789
    # 允许互动的用户 ID 列表 (安全设置)
    allowed_users:
      - 12345678
    # 话题 ID (可选，用于 Supergroup 话题)
    thread_id: null
    # 代理地址 (可选)
    proxy_url: null

    # 图片压缩配置
    image_quality: 85 # JPEG 压缩质量 (50-100)
    max_image_size: 2000 # 图片最大边长 (px)

    # Topic 智能分流 (可选，用于 Supergroup 话题自动分类)
    # topic_rules:
    #   default: null           # 默认 topic_id (null = 不使用 topic)
    #   r18: 12345              # R18 作品自动发送到此 topic
    #   wallpaper: 12346        # 风景作品发送到此 topic
    # topic_tag_mapping:        # 标签到分类的映射
    #   wallpaper: ["風景", "背景", "landscape", "scenery"]

  # OneBot / QQ
  onebot:
    ws_url: "ws://127.0.0.1:3001"
    private_id: 12345678 # 私聊目标 QQ
    group_id: null # 群聊目标群号
    push_to_private: true
    push_to_group: false
    master_id: 12345678 # 主人 QQ

# 反馈与权重配置
feedback:
  like_boost: 0.5 # 喜欢时权重增加量
  dislike_penalty: 0.3 # 不喜欢时权重减少量
  dislike_threshold: 3 # 累计不喜欢达到此次数时，提示建议屏蔽
  max_chain_depth: 3 # 单图连锁深度上限 (A→B→C共3层)
  related_push_limit: 1 # 每次反馈触发关联推送的数量

network:
  max_concurrency: 5
  random_delay: [1.0, 3.0]
  requests_per_minute: 60

web:
  enabled: false
  password: "YOUR_PASSWORD_HERE"
  port: 8000
